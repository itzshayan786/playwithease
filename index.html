<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayWithEase | PS5 Experience</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Saira:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <style>
        :root {
            --bg: #000000;
            --glass: rgba(255, 255, 255, 0.08);
            --glass-hover: rgba(255, 255, 255, 0.2);
            --sony-blue: #0070d1;
            --accent: #ffffff;
            --text-grey: #b3b3b3;
            --danger: #ff3333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Saira', sans-serif; }
        body { background-color: var(--bg); color: white; overflow-x: hidden; user-select: none; }
        
        /* --- BACKGROUND AMBIENCE --- */
        .ambient-glow {
            position: fixed; top: -20%; right: -10%; width: 50vw; height: 50vw;
            background: radial-gradient(circle, var(--sony-blue) 0%, transparent 70%);
            opacity: 0.2; z-index: -1; pointer-events: none;
        }

        /* --- HEADER --- */
        header {
            position: fixed; top: 0; width: 100%; z-index: 1000;
            padding: 20px 40px; display: flex; justify-content: space-between; align-items: center;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
        }
        
        .nav-left { display: flex; gap: 30px; font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; }
        .nav-item { opacity: 0.6; cursor: pointer; transition: 0.3s; position: relative; }
        .nav-item.active, .nav-item:hover { opacity: 1; text-shadow: 0 0 10px white; }
        .nav-item.active::after {
            content: ''; position: absolute; bottom: -5px; left: 0; width: 100%; height: 2px; background: var(--sony-blue);
        }

        .offline-btn {
            background: rgba(255, 50, 50, 0.2); border: 1px solid rgba(255, 50, 50, 0.5);
            padding: 8px 16px; border-radius: 20px; font-size: 11px; font-weight: 700;
            display: flex; align-items: center; gap: 8px; cursor: pointer; transition: 0.3s;
        }
        .offline-btn:hover { background: rgba(255, 50, 50, 0.8); box-shadow: 0 0 20px red; }

        .auth-btn {
            background: white; color: black; padding: 8px 24px; border-radius: 20px;
            font-weight: 700; font-size: 13px; cursor: pointer; border: none;
        }

        .cart-icon-wrapper { position: relative; cursor: pointer; }
        .cart-badge {
            position: absolute; top: -5px; right: -8px; background: var(--sony-blue);
            color: white; font-size: 10px; font-weight: bold; width: 16px; height: 16px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
        }

        /* --- HERO SECTION (DYNAMIC) --- */
        .hero {
            height: 85vh; position: relative; display: flex; align-items: flex-end; padding-bottom: 80px;
            transition: background 0.5s; overflow: hidden;
        }
        
        .hero-bg-img {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: -1; mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 50%, transparent 100%);
            transition: opacity 0.8s ease;
        }

        .hero-content {
            padding-left: 60px; width: 50%; z-index: 10;
            transform: translateY(20px); opacity: 0; transition: 0.5s ease-out;
        }
        .hero-content.visible { transform: translateY(0); opacity: 1; }

        .game-logo-text {
            font-size: 60px; font-weight: 900; line-height: 1; text-transform: uppercase;
            margin-bottom: 15px; text-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        
        .meta-tags { display: flex; gap: 15px; font-size: 12px; color: var(--text-grey); margin-bottom: 20px; font-weight: 600; }
        .tag-box { border: 1px solid white; padding: 2px 6px; border-radius: 3px; color: white; }

        .hero-desc { font-size: 16px; color: #e0e0e0; margin-bottom: 30px; max-width: 500px; text-shadow: 1px 1px 2px black; }

        .price-tag { font-size: 24px; font-weight: 300; margin-bottom: 20px; }
        .price-tag span { font-weight: 700; font-size: 32px; }

        .action-row { display: flex; gap: 20px; }
        .btn-primary {
            background: var(--sony-blue); color: white; border: none; padding: 12px 30px;
            border-radius: 30px; font-weight: 700; font-size: 16px; cursor: pointer;
            transition: 0.3s; display: flex; align-items: center; gap: 10px;
        }
        .btn-primary:hover { transform: scale(1.05); box-shadow: 0 0 30px var(--sony-blue); }

        .btn-glass {
            background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); color: white; border: none;
            padding: 12px 20px; border-radius: 30px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 10px;
        }
        .btn-glass:hover { background: white; color: black; }

        /* --- HERO SWITCHER --- */
        .hero-switch {
            position: absolute; bottom: 40px; right: 60px; display: flex; gap: 20px; z-index: 20;
        }
        .switch-card {
            width: 160px; height: 90px; border-radius: 12px; overflow: hidden; cursor: pointer;
            border: 2px solid transparent; transition: 0.3s; position: relative;
        }
        .switch-card img { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; }
        .switch-card:hover, .switch-card.active { border-color: white; transform: scale(1.1); box-shadow: 0 10px 30px black; }
        .switch-card.active img { opacity: 1; }
        .switch-label {
            position: absolute; bottom: 5px; left: 10px; font-size: 10px; font-weight: 700; text-shadow: 0 0 5px black;
        }

        /* --- SHELVES --- */
        .shelf { padding: 40px 0 40px 60px; }
        .shelf-title { font-size: 22px; margin-bottom: 20px; font-weight: 300; }
        .shelf-title b { font-weight: 700; }

        .rail {
            display: flex; gap: 25px; overflow-x: auto; padding-bottom: 30px; padding-right: 60px;
            scrollbar-width: none;
        }
        .rail::-webkit-scrollbar { display: none; }

        .game-card {
            min-width: 200px; width: 200px; cursor: pointer; transition: 0.3s; position: relative;
        }
        .game-card:hover { transform: translateY(-10px) scale(1.02); z-index: 5; }
        
        .card-art {
            width: 100%; aspect-ratio: 2/3; border-radius: 12px; overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); position: relative;
        }
        .card-art img { width: 100%; height: 100%; object-fit: cover; }
        .game-card:hover .card-art { box-shadow: 0 0 0 3px white; }

        .add-to-cart-btn {
            position: absolute; bottom: 10px; right: 10px; width: 35px; height: 35px;
            background: var(--sony-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center;
            opacity: 0; transform: translateY(10px); transition: 0.3s; color: white;
        }
        .game-card:hover .add-to-cart-btn { opacity: 1; transform: translateY(0); }
        .add-to-cart-btn:hover { background: white; color: var(--sony-blue); }

        .card-meta { margin-top: 15px; opacity: 0.7; transition: 0.3s; }
        .game-card:hover .card-meta { opacity: 1; }
        .card-title { font-size: 15px; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .card-price { font-size: 13px; color: var(--text-grey); margin-top: 4px; }

        /* --- CART SIDEBAR --- */
        .cart-sidebar {
            position: fixed; top: 0; right: -400px; width: 350px; height: 100%;
            background: #111; border-left: 1px solid #333; z-index: 2000;
            transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            display: flex; flex-direction: column; box-shadow: -10px 0 50px rgba(0,0,0,0.5);
        }
        .cart-sidebar.open { right: 0; }
        
        .cart-header {
            padding: 20px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center;
            font-size: 18px; font-weight: 700;
        }
        .close-cart { cursor: pointer; color: var(--text-grey); transition: 0.2s; }
        .close-cart:hover { color: white; }

        .cart-items { flex: 1; overflow-y: auto; padding: 20px; }
        .cart-item {
            display: flex; gap: 15px; margin-bottom: 20px; background: #1a1a1a; padding: 10px; border-radius: 8px;
            position: relative; transition: 0.2s;
        }
        .cart-item:hover { background: #222; }
        .cart-img { width: 60px; height: 80px; object-fit: cover; border-radius: 4px; }
        .cart-info { display: flex; flex-direction: column; justify-content: center; }
        .cart-title { font-size: 13px; font-weight: 600; margin-bottom: 5px; }
        .cart-price { font-size: 12px; color: var(--sony-blue); font-weight: 700; }
        
        .remove-item {
            position: absolute; top: 10px; right: 10px; color: #555; cursor: pointer; font-size: 12px;
        }
        .remove-item:hover { color: var(--danger); }

        .cart-footer { padding: 25px; border-top: 1px solid #222; background: #0a0a0a; }
        .total-row { display: flex; justify-content: space-between; font-size: 18px; font-weight: 700; margin-bottom: 20px; }
        .checkout-btn {
            width: 100%; padding: 15px; background: var(--sony-blue); color: white;
            border: none; border-radius: 30px; font-weight: 700; cursor: pointer; transition: 0.2s;
        }
        .checkout-btn:hover { opacity: 0.9; }

        /* --- SHOOTER GAME MODAL --- */
        .game-modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #050505; z-index: 5000;
            display: none; flex-direction: column; justify-content: center; align-items: center;
        }
        .game-container { position: relative; width: 800px; height: 600px; box-shadow: 0 0 100px rgba(0, 112, 209, 0.3); border: 2px solid #222; background: #000; border-radius: 8px; overflow: hidden; }
        canvas { display: block; width: 100%; height: 100%; cursor: crosshair; }
        
        .game-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(5px);
            z-index: 2;
        }
        .game-overlay.hidden { display: none; }
        
        .game-title-text { font-size: 48px; font-weight: 800; color: white; letter-spacing: 5px; margin-bottom: 20px; text-shadow: 0 0 20px var(--sony-blue); }
        .game-controls { color: #aaa; margin-bottom: 40px; text-align: center; line-height: 1.6; }
        .game-controls kbd { border: 1px solid #555; padding: 2px 6px; border-radius: 4px; color: white; background: #222; }

        .hud {
            position: absolute; top: 20px; left: 20px; right: 20px; display: flex; justify-content: space-between;
            pointer-events: none; z-index: 1; font-family: 'Courier New', monospace; font-weight: bold;
        }
        .hp-bar-bg { width: 200px; height: 20px; background: #333; border: 1px solid #555; transform: skewX(-20deg); }
        .hp-bar-fill { width: 100%; height: 100%; background: #00ff88; transition: width 0.1s; box-shadow: 0 0 10px #00ff88; }

        /* --- VIDEO MODAL --- */
        .video-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: black; z-index: 4000;
            display: none; align-items: center; justify-content: center;
        }
        .close-video { position: absolute; top: 30px; right: 30px; font-size: 40px; cursor: pointer; z-index: 4001; }

    </style>
</head>
<body>

    <div class="ambient-glow"></div>

    <header>
        <div class="nav-left">
            <div class="nav-item active">Games</div>
            <div class="nav-item">Hardware</div>
            <div class="nav-item">Services</div>
            <div class="nav-item">News</div>
        </div>

        <div style="display: flex; gap: 20px; align-items: center;">
            <div class="offline-btn" onclick="openShooterGame()">
                <i class="fas fa-gamepad"></i>
                PLAY CYBER DEFENSE
            </div>
            <div class="nav-item"><i class="fas fa-search"></i></div>
            
            <div class="nav-item cart-icon-wrapper" onclick="toggleCart()">
                <i class="fas fa-shopping-bag"></i>
                <div class="cart-badge" id="cartBadge">0</div>
            </div>

            <button class="auth-btn" id="loginBtn" onclick="handleLogin()">Sign In</button>
        </div>
    </header>

    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-header">
            <span>Your Cart</span>
            <span class="close-cart" onclick="toggleCart()">&times;</span>
        </div>
        <div class="cart-items" id="cartItemsContainer">
            <div style="text-align: center; color: #555; margin-top: 50px;">Your cart is empty.</div>
        </div>
        <div class="cart-footer">
            <div class="total-row">
                <span>Total</span>
                <span id="cartTotal">$0.00</span>
            </div>
            <button class="checkout-btn">Checkout</button>
        </div>
    </div>

    <section class="hero" id="hero-section">
        <img id="hero-bg" src="https://images.hdqwalls.com/wallpapers/gta-vi-4k-logo-fo.jpg" class="hero-bg-img">
        
        <div class="hero-content visible" id="hero-text">
            <div class="meta-tags">
                <span class="tag-box">PS5</span>
                <span>EXCLUSIVE PREMIERE</span>
            </div>
            <div class="game-logo-text" id="hero-title">Grand Theft Auto VI</div>
            <p class="hero-desc" id="hero-desc">
                Welcome to Leonida. Experience the next evolution of the open world with Jason and Lucia in the most immersive Vice City ever created.
            </p>
            <div class="price-tag">Pre-Order <span>$69.99</span></div>
            <div class="action-row">
                <button class="btn-primary" onclick="addToCart('Grand Theft Auto VI', 69.99, 'https://images.hdqwalls.com/wallpapers/gta-vi-4k-logo-fo.jpg')">Pre-Order Now</button>
                <button class="btn-glass" onclick="playTrailer()"><i class="fas fa-play"></i> Watch Trailer</button>
            </div>
        </div>

        <div class="hero-switch">
            <div class="switch-card active" onclick="switchGame('gta')">
                <img src="https://images.hdqwalls.com/wallpapers/gta-vi-4k-logo-fo.jpg" alt="GTA VI">
                <div class="switch-label">GTA VI</div>
            </div>
            <div class="switch-card" onclick="switchGame('forza')">
                <img src="https://images.hdqwalls.com/wallpapers/forza-horizon-5-4k-game-3r.jpg" alt="Forza">
                <div class="switch-label">FORZA 6</div>
            </div>
        </div>
    </section>

    <div class="shelf">
        <div class="shelf-title">Top 10 <b>in Your Region</b></div>
        <div class="rail" id="trending-rail">
            </div>
    </div>

    <div class="shelf">
        <div class="shelf-title">Coming <b>Soon</b></div>
        <div class="rail" id="soon-rail">
            </div>
    </div>

    <div class="game-modal" id="shooterModal">
        <button class="btn-glass" onclick="closeShooterGame()" style="position: absolute; top: 30px; right: 30px;">EXIT TO STORE</button>
        
        <div class="game-container">
            <div class="hud">
                <div class="hp-bar-bg"><div class="hp-bar-fill" id="gameHP"></div></div>
                <div style="color: #00ff88; text-shadow: 0 0 10px #00ff88;">SCORE: <span id="gameScore">0</span></div>
            </div>
            
            <div class="game-overlay" id="startScreen">
                <div class="game-title-text">CYBER DEFENSE</div>
                <div class="game-controls">
                    <p><kbd>W</kbd><kbd>A</kbd><kbd>S</kbd><kbd>D</kbd> Move</p>
                    <p><kbd>MOUSE</kbd> Aim</p>
                    <p><kbd>CLICK</kbd> Shoot</p>
                </div>
                <button class="btn-primary" onclick="startGame()">START MISSION</button>
            </div>

            <div class="game-overlay hidden" id="gameOverScreen">
                <div class="game-title-text" style="color: #ff3333; text-shadow: 0 0 20px red;">MISSION FAILED</div>
                <div style="font-size: 24px; margin-bottom: 30px;">FINAL SCORE: <span id="finalScore">0</span></div>
                <button class="btn-primary" onclick="startGame()">RETRY</button>
            </div>

            <canvas id="shooterCanvas"></canvas>
        </div>
    </div>

    <div class="video-overlay" id="videoOverlay">
        <div class="close-video" onclick="closeTrailer()">&times;</div>
        <iframe id="youtube-embed" width="80%" height="80%" src="" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
    </div>

    <script>
        // --- 1. HERO LOGIC ---
        const games = {
            gta: {
                title: "Grand Theft Auto VI",
                desc: "Welcome to Leonida. Experience the next evolution of the open world with Jason and Lucia in the most immersive Vice City ever created.",
                bg: "https://images.hdqwalls.com/wallpapers/gta-vi-4k-logo-fo.jpg",
                trailer: "QdBZY2fkU-0",
                price: "$69.99",
                cleanPrice: 69.99
            },
            forza: {
                title: "Forza Horizon 6",
                desc: "The Horizon Festival moves to Japan. Drift through neon-lit Tokyo streets and race down Mount Fuji in the most visually stunning racer ever made.",
                bg: "https://images.hdqwalls.com/wallpapers/forza-horizon-5-4k-game-3r.jpg",
                trailer: "FYH9n37B7Yw",
                price: "$59.99",
                cleanPrice: 59.99
            }
        };

        let activeGame = 'gta';

        function switchGame(gameKey) {
            if(activeGame === gameKey) return;
            activeGame = gameKey;
            const data = games[gameKey];

            document.querySelectorAll('.switch-card').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');

            const bg = document.getElementById('hero-bg');
            const text = document.getElementById('hero-text');
            
            text.classList.remove('visible');
            bg.style.opacity = 0;

            setTimeout(() => {
                bg.src = data.bg;
                document.getElementById('hero-title').innerText = data.title;
                document.getElementById('hero-desc').innerText = data.desc;
                // Update button action for Add to Cart
                const btn = document.querySelector('.action-row .btn-primary');
                btn.onclick = () => addToCart(data.title, data.cleanPrice, data.bg);
                
                bg.style.opacity = 1;
                text.classList.add('visible');
            }, 500);
        }

        function playTrailer() {
            const id = games[activeGame].trailer;
            document.getElementById('videoOverlay').style.display = 'flex';
            document.getElementById('youtube-embed').src = `https://www.youtube.com/embed/${id}?autoplay=1`;
        }

        function closeTrailer() {
            document.getElementById('videoOverlay').style.display = 'none';
            document.getElementById('youtube-embed').src = "";
        }

        // --- 2. GAME RAILS ---
        const railData = [
            { t: "Elden Ring", p: 39.99, i: "https://images.igdb.com/igdb/image/upload/t_cover_big/co848v.jpg" },
            { t: "Black Myth: Wukong", p: 59.99, i: "https://images.igdb.com/igdb/image/upload/t_cover_big/co8ush.jpg" },
            { t: "Spider-Man 2", p: 69.99, i: "https://images.igdb.com/igdb/image/upload/t_cover_big/co660r.jpg" },
            { t: "God of War RagnarÃ¶k", p: 49.99, i: "https://images.igdb.com/igdb/image/upload/t_cover_big/co5s5v.jpg" },
            { t: "Cyberpunk 2077", p: 29.99, i: "https://images.igdb.com/igdb/image/upload/t_cover_big/co2mjs.jpg" },
            { t: "Resident Evil 4", p: 39.99, i: "https://images.igdb.com/igdb/image/upload/t_cover_big/co628e.jpg" },
        ];

        const rail = document.getElementById('trending-rail');
        [...railData, ...railData].forEach(g => {
            rail.innerHTML += `
                <div class="game-card">
                    <div class="card-art">
                        <img src="${g.i}" loading="lazy">
                        <div class="add-to-cart-btn" onclick="addToCart('${g.t}', ${g.p}, '${g.i}')">
                            <i class="fas fa-plus"></i>
                        </div>
                    </div>
                    <div class="card-meta"><div class="card-title">${g.t}</div><div class="card-price">$${g.p}</div></div>
                </div>`;
        });
        document.getElementById('soon-rail').innerHTML = rail.innerHTML;

        // --- 3. CART SYSTEM LOGIC ---
        let cart = [];

        function toggleCart() {
            const sidebar = document.getElementById('cartSidebar');
            sidebar.classList.toggle('open');
        }

        function addToCart(title, price, image) {
            cart.push({ title, price, image });
            updateCartUI();
            
            // Animation for feedback
            const badge = document.getElementById('cartBadge');
            badge.style.transform = "scale(1.5)";
            setTimeout(() => badge.style.transform = "scale(1)", 200);
            
            // Auto open cart on add
            document.getElementById('cartSidebar').classList.add('open');
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartUI();
        }

        function updateCartUI() {
            const container = document.getElementById('cartItemsContainer');
            const totalEl = document.getElementById('cartTotal');
            const badge = document.getElementById('cartBadge');

            badge.innerText = cart.length;

            if (cart.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #555; margin-top: 50px;">Your cart is empty.</div>';
                totalEl.innerText = "$0.00";
                return;
            }

            let html = '';
            let total = 0;

            cart.forEach((item, index) => {
                total += item.price;
                html += `
                    <div class="cart-item">
                        <img src="${item.image}" class="cart-img">
                        <div class="cart-info">
                            <div class="cart-title">${item.title}</div>
                            <div class="cart-price">$${item.price.toFixed(2)}</div>
                        </div>
                        <div class="remove-item" onclick="removeFromCart(${index})"><i class="fas fa-trash"></i></div>
                    </div>
                `;
            });

            container.innerHTML = html;
            totalEl.innerText = "$" + total.toFixed(2);
        }

        // --- 4. CYBER DEFENSE SHOOTER ENGINE ---
        const canvas = document.getElementById('shooterCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = 800; canvas.height = 600;

        let gameLoopId;
        let lastTime = 0;
        let score = 0;
        let isGameOver = false;

        // Entities
        const player = { x: 400, y: 300, radius: 15, speed: 5, hp: 100, maxHp: 100 };
        let bullets = [];
        let enemies = [];
        let particles = [];
        
        // Input
        const keys = { w: false, a: false, s: false, d: false };
        const mouse = { x: 0, y: 0 };

        function openShooterGame() {
            document.getElementById('shooterModal').style.display = 'flex';
            window.addEventListener('keydown', handleKey);
            window.addEventListener('keyup', handleKey);
            canvas.addEventListener('mousemove', handleMouse);
            canvas.addEventListener('mousedown', shoot);
        }

        function closeShooterGame() {
            document.getElementById('shooterModal').style.display = 'none';
            cancelAnimationFrame(gameLoopId);
            window.removeEventListener('keydown', handleKey);
            window.removeEventListener('keyup', handleKey);
        }

        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameOverScreen').classList.add('hidden');
            
            // Reset Game State
            player.x = 400; player.y = 300; player.hp = 100;
            bullets = []; enemies = []; particles = []; score = 0;
            isGameOver = false;
            updateHUD();

            gameLoopId = requestAnimationFrame(loop);
        }

        function loop(timestamp) {
            if(isGameOver) return;
            const dt = timestamp - lastTime;
            lastTime = timestamp;

            update();
            draw();
            
            // Enemy Spawner
            if(Math.random() < 0.02 + (score * 0.0001)) spawnEnemy();

            gameLoopId = requestAnimationFrame(loop);
        }

        function update() {
            // Player Movement
            if(keys.w && player.y > 0) player.y -= player.speed;
            if(keys.s && player.y < canvas.height) player.y += player.speed;
            if(keys.a && player.x > 0) player.x -= player.speed;
            if(keys.d && player.x < canvas.width) player.x += player.speed;

            // Bullets
            bullets.forEach((b, i) => {
                b.x += b.vx; b.y += b.vy;
                if(b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) bullets.splice(i, 1);
            });

            // Enemies
            enemies.forEach((e, i) => {
                const angle = Math.atan2(player.y - e.y, player.x - e.x);
                e.x += Math.cos(angle) * e.speed;
                e.y += Math.sin(angle) * e.speed;

                // Collision with Player
                const dist = Math.hypot(player.x - e.x, player.y - e.y);
                if(dist < player.radius + e.radius) {
                    player.hp -= 10;
                    enemies.splice(i, 1);
                    screenShake();
                    updateHUD();
                    spawnParticles(e.x, e.y, '#ff3333', 5);
                    if(player.hp <= 0) gameOver();
                }

                // Collision with Bullets
                bullets.forEach((b, bi) => {
                    const bDist = Math.hypot(b.x - e.x, b.y - e.y);
                    if(bDist < e.radius + 5) {
                        enemies.splice(i, 1);
                        bullets.splice(bi, 1);
                        score += 100;
                        updateHUD();
                        spawnParticles(e.x, e.y, '#ff3333', 10);
                        spawnParticles(e.x, e.y, '#ffffff', 5);
                    }
                });
            });

            // Particles
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.life -= 0.05;
                if(p.life <= 0) particles.splice(i, 1);
            });
        }

        function draw() {
            // Trail Effect
            ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw Player (Triangle pointing to mouse)
            ctx.save();
            ctx.translate(player.x, player.y);
            const angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
            ctx.rotate(angle);
            ctx.fillStyle = '#0070d1';
            ctx.shadowBlur = 15; ctx.shadowColor = '#0070d1';
            ctx.beginPath();
            ctx.moveTo(15, 0); ctx.lineTo(-10, 10); ctx.lineTo(-10, -10);
            ctx.fill();
            ctx.restore();

            // Draw Bullets
            ctx.fillStyle = '#00ff88';
            ctx.shadowColor = '#00ff88';
            bullets.forEach(b => {
                ctx.beginPath(); ctx.arc(b.x, b.y, 3, 0, Math.PI*2); ctx.fill();
            });

            // Draw Enemies
            enemies.forEach(e => {
                ctx.fillStyle = '#ff3333';
                ctx.shadowColor = 'red';
                ctx.beginPath();
                ctx.rect(e.x - e.radius, e.y - e.radius, e.radius*2, e.radius*2);
                ctx.fill();
            });

            // Draw Particles
            particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.size, 0, Math.PI*2); ctx.fill();
                ctx.globalAlpha = 1;
            });
        }

        function shoot() {
            if(isGameOver) return;
            const angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
            const velocity = { x: Math.cos(angle) * 12, y: Math.sin(angle) * 12 };
            bullets.push({ x: player.x, y: player.y, vx: velocity.x, vy: velocity.y });
        }

        function spawnEnemy() {
            const side = Math.floor(Math.random() * 4);
            let x, y;
            if(side === 0) { x = Math.random()*canvas.width; y = -20; }
            if(side === 1) { x = canvas.width+20; y = Math.random()*canvas.height; }
            if(side === 2) { x = Math.random()*canvas.width; y = canvas.height+20; }
            if(side === 3) { x = -20; y = Math.random()*canvas.height; }
            
            enemies.push({ x, y, radius: 15, speed: 2 + Math.random() });
        }

        function spawnParticles(x, y, color, count) {
            for(let i=0; i<count; i++) {
                particles.push({
                    x, y, color,
                    vx: (Math.random()-0.5) * 5,
                    vy: (Math.random()-0.5) * 5,
                    life: 1, size: Math.random() * 3
                });
            }
        }

        function updateHUD() {
            document.getElementById('gameScore').innerText = score;
            document.getElementById('gameHP').style.width = player.hp + '%';
            if(player.hp < 30) document.getElementById('gameHP').style.background = 'red';
            else document.getElementById('gameHP').style.background = '#00ff88';
        }

        function gameOver() {
            isGameOver = true;
            document.getElementById('finalScore').innerText = score;
            document.getElementById('gameOverScreen').classList.remove('hidden');
        }

        function screenShake() {
            canvas.style.transform = `translate(${Math.random()*10-5}px, ${Math.random()*10-5}px)`;
            setTimeout(() => canvas.style.transform = 'translate(0,0)', 50);
        }

        // Input Handlers
        function handleKey(e) {
            if(e.type === 'keydown') {
                if(e.key === 'w') keys.w = true;
                if(e.key === 'a') keys.a = true;
                if(e.key === 's') keys.s = true;
                if(e.key === 'd') keys.d = true;
            } else {
                if(e.key === 'w') keys.w = false;
                if(e.key === 'a') keys.a = false;
                if(e.key === 's') keys.s = false;
                if(e.key === 'd') keys.d = false;
            }
        }
        function handleMouse(e) {
            const rect = canvas.getBoundingClientRect();
            mouse.x = e.clientX - rect.left;
            mouse.y = e.clientY - rect.top;
        }

        // --- 5. FIREBASE AUTH ---
        const firebaseConfig = {
            apiKey: "AIzaSyAxuYwom2tuGTz3Nsi-6ndYSwK7BkEJIVs",
            authDomain: "playwithease.firebaseapp.com",
            projectId: "playwithease",
            storageBucket: "playwithease.firebasestorage.app",
            messagingSenderId: "189729941006",
            appId: "1:189729941006:web:362653774b92416c357e5f",
            measurementId: "G-1C3B31KQ7C"
        };
        
        try {
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const provider = new firebase.auth.GoogleAuthProvider();

            window.handleLogin = () => {
                auth.signInWithPopup(provider).catch(e => alert(e.message));
            };

            auth.onAuthStateChanged(user => {
                const btn = document.getElementById('loginBtn');
                if(user) {
                    btn.innerHTML = `<i class="fas fa-user-circle"></i> ${user.email.split('@')[0]}`;
                    btn.onclick = () => auth.signOut();
                } else {
                    btn.innerText = "Sign In";
                    btn.onclick = handleLogin;
                }
            });
        } catch(e) { console.log("Firebase config error"); }

    </script>
</body>
</html>
