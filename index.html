<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlayWithEase | Digital Game Keys & Gift Cards</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'sans-serif'] },
                    colors: { primary: '#6d28d9', secondary: '#4c1d95' }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; }
        .hide { display: none !important; }
        .cart-slide { transform: translateX(100%); transition: transform 0.3s ease-in-out; }
        .cart-open { transform: translateX(0); }
        .product-card { transition: box-shadow 0.3s ease, transform 0.2s ease; }
        .product-card:hover { transform: translateY(-3px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1); }
        .product-img-wrapper { overflow: hidden; }
        .product-img { transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        .product-card:hover .product-img { transform: scale(1.08); }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-gray-900 dark:text-gray-100 transition-colors duration-200">

    <header class="sticky top-0 z-40 w-full bg-white dark:bg-gray-800 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex-shrink-0 flex items-center cursor-pointer" onclick="showView('homeView')">
                    <i class="fa-solid fa-gamepad text-3xl text-primary mr-2"></i>
                    <span class="font-bold text-2xl tracking-tight">PlayWith<span class="text-primary">Ease</span></span>
                </div>
                
                <div class="hidden md:flex flex-1 max-w-lg mx-8">
                    <div class="relative w-full">
                        <input type="text" placeholder="Search games, gift cards..." class="w-full bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-full py-2 pl-4 pr-10 focus:outline-none focus:ring-2 focus:ring-primary">
                        <button class="absolute right-3 top-2 text-gray-400 hover:text-primary"><i class="fa-solid fa-search"></i></button>
                    </div>
                </div>

                <div class="flex items-center space-x-4">
                    <button id="currencyBtn" class="font-semibold text-sm hover:text-primary">INR ₹</button>
                    <button id="themeToggle" class="text-xl text-gray-500 hover:text-primary"><i class="fa-solid fa-moon"></i></button>
                    <button id="authBtn" class="text-xl text-gray-500 hover:text-primary" onclick="handleAuthClick()"><i class="fa-regular fa-user"></i></button>
                    <button class="relative text-xl text-gray-500 hover:text-primary" onclick="toggleCart()">
                        <i class="fa-solid fa-cart-shopping"></i>
                        <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 min-h-screen" id="mainContent">
        
        <div id="homeView">
            <div class="bg-gradient-to-r from-primary to-purple-900 rounded-2xl p-8 sm:p-12 mb-10 text-white shadow-lg flex flex-col md:flex-row items-center justify-between">
                <div>
                    <h1 class="text-4xl md:text-5xl font-bold mb-4">Level Up Your Library</h1>
                    <p class="text-lg md:text-xl mb-6 opacity-90">Instant digital keys, localized gift cards, and premium subscriptions.</p>
                    <button class="bg-white text-primary font-bold py-3 px-8 rounded-full shadow hover:bg-gray-100 transition" onclick="document.getElementById('gamesSection').scrollIntoView()">Shop Now</button>
                </div>
                <div class="hidden md:block">
                    <i class="fa-solid fa-vr-cardboard text-9xl opacity-80 animate-pulse"></i>
                </div>
            </div>

            <h2 id="gamesSection" class="text-2xl font-bold mb-6 border-b border-gray-200 dark:border-gray-700 pb-2"><i class="fa-solid fa-fire text-orange-500 mr-2"></i>Trending Games</h2>
            <div id="gamesGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6 mb-12"></div>

            <h2 class="text-2xl font-bold mb-6 border-b border-gray-200 dark:border-gray-700 pb-2"><i class="fa-solid fa-gift text-pink-500 mr-2"></i>Gift Cards</h2>
            <div id="giftCardsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-12"></div>

            <h2 class="text-2xl font-bold mb-6 border-b border-gray-200 dark:border-gray-700 pb-2"><i class="fa-solid fa-ticket text-blue-500 mr-2"></i>Subscriptions</h2>
            <div id="subsGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-12"></div>
        </div>

        <div id="authView" class="hide max-w-md mx-auto mt-10 bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg">
            <h2 id="authTitle" class="text-2xl font-bold mb-6 text-center">Login to PlayWithEase</h2>
            <form id="authForm" onsubmit="handleAuthSubmit(event)">
                <div class="mb-4">
                    <label class="block text-sm font-medium mb-1">Email</label>
                    <input type="email" id="authEmail" required class="w-full border dark:border-gray-600 rounded px-3 py-2 bg-gray-50 dark:bg-gray-700">
                </div>
                <div class="mb-6">
                    <label class="block text-sm font-medium mb-1">Password</label>
                    <input type="password" id="authPassword" required class="w-full border dark:border-gray-600 rounded px-3 py-2 bg-gray-50 dark:bg-gray-700">
                </div>
                <button type="submit" class="w-full bg-primary text-white py-2 rounded font-bold hover:bg-secondary transition">Submit</button>
            </form>
            <p class="mt-4 text-center text-sm">
                <span id="authToggleText">Don't have an account?</span> 
                <button class="text-primary font-bold" onclick="toggleAuthMode()">Toggle here</button>
            </p>
            <div id="authError" class="text-red-500 text-sm text-center mt-3 hide"></div>
        </div>

        <div id="profileView" class="hide max-w-3xl mx-auto mt-10">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8">
                <div class="flex items-center border-b dark:border-gray-700 pb-6 mb-6">
                    <div class="w-24 h-24 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center text-4xl text-gray-400 mr-6">
                        <i class="fa-solid fa-user"></i>
                    </div>
                    <div>
                        <h2 class="text-3xl font-bold" id="profileEmail">user@example.com</h2>
                        <p class="text-gray-500 dark:text-gray-400">PlayWithEase Member</p>
                        <button class="mt-2 text-sm bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded hover:bg-gray-300 dark:hover:bg-gray-600"><i class="fa-solid fa-pen mr-1"></i>Edit Profile</button>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="bg-purple-50 dark:bg-gray-700 p-4 rounded-lg text-center">
                        <span class="block text-3xl font-bold text-primary">0</span>
                        <span class="text-sm text-gray-500 dark:text-gray-300">Total Orders</span>
                    </div>
                    <div class="bg-purple-50 dark:bg-gray-700 p-4 rounded-lg text-center">
                        <span class="block text-3xl font-bold text-primary">0</span>
                        <span class="text-sm text-gray-500 dark:text-gray-300">Wishlist Items</span>
                    </div>
                </div>
                <button onclick="logoutUser()" class="w-full bg-red-500 text-white py-3 rounded-lg font-bold hover:bg-red-600 transition"><i class="fa-solid fa-right-from-bracket mr-2"></i>Logout</button>
            </div>
        </div>

        <div id="checkoutView" class="hide max-w-2xl mx-auto mt-10">
            <h2 class="text-3xl font-bold mb-6">Checkout</h2>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6 mb-6">
                <h3 class="text-xl font-semibold mb-4 border-b pb-2">Order Summary</h3>
                <div id="checkoutItems" class="mb-4 space-y-2"></div>
                <div class="flex justify-between font-bold text-lg pt-4 border-t">
                    <span>Total Pay:</span>
                    <span id="checkoutTotal">₹0</span>
                </div>
            </div>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow p-6 text-center">
                <h3 class="text-xl font-semibold mb-2">Pay via UPI</h3>
                <p class="text-gray-500 dark:text-gray-400 mb-4">Scan the QR or use the UPI ID below to complete your payment.</p>
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=upi://pay?pa=shayanff98@okhdfcbank&pn=PlayWithEase" alt="UPI QR" class="mx-auto mb-4 border-4 border-white rounded">
                <p class="text-lg font-mono bg-gray-100 dark:bg-gray-700 py-2 rounded mb-6">shayanff98@okhdfcbank</p>
                <button onclick="confirmOrder()" class="bg-green-500 text-white w-full py-3 rounded-lg font-bold hover:bg-green-600 transition text-lg">I Have Paid</button>
            </div>
        </div>

        <div id="successView" class="hide max-w-md mx-auto mt-20 text-center">
            <i class="fa-solid fa-circle-check text-6xl text-green-500 mb-4"></i>
            <h2 class="text-3xl font-bold mb-2">Payment Received!</h2>
            <p class="text-gray-500 dark:text-gray-400 mb-6">Your digital keys will be emailed to you shortly.</p>
            <button onclick="showView('homeView')" class="bg-primary text-white py-2 px-6 rounded-full font-bold hover:bg-secondary">Continue Shopping</button>
        </div>

    </main>

    <div id="cartDrawer" class="fixed inset-y-0 right-0 w-full md:w-96 bg-white dark:bg-gray-800 shadow-2xl z-50 cart-slide flex flex-col">
        <div class="p-4 border-b dark:border-gray-700 flex justify-between items-center">
            <h2 class="text-xl font-bold"><i class="fa-solid fa-cart-shopping mr-2"></i>Your Cart</h2>
            <button onclick="toggleCart()" class="text-gray-500 hover:text-red-500 text-xl"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div id="cartItems" class="flex-1 overflow-y-auto p-4 space-y-4"></div>
        <div class="p-6 border-t dark:border-gray-700 bg-gray-50 dark:bg-gray-900">
            <div class="flex justify-between font-bold text-lg mb-4">
                <span>Total:</span>
                <span id="cartTotalUI">₹0</span>
            </div>
            <button onclick="proceedToCheckout()" class="w-full bg-primary text-white py-3 rounded font-bold hover:bg-secondary transition">Checkout</button>
        </div>
    </div>
    <div id="cartOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hide" onclick="toggleCart()"></div>

    <footer class="bg-gray-800 text-gray-300 py-8 text-center">
        <p>&copy; 2026 PlayWithEase. All digital goods delivered instantly.</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAxuYwom2tuGTz3Nsi-6ndYSwK7BkEJIVs",
            authDomain: "playwithease.firebaseapp.com",
            projectId: "playwithease",
            storageBucket: "playwithease.firebasestorage.app",
            messagingSenderId: "189729941006",
            appId: "1:189729941006:web:362653774b92416c357e5f",
            measurementId: "G-1C3B31KQ7C"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // --- GLOBAL STATE ---
        let cart = JSON.parse(localStorage.getItem('playWithEaseCart')) || [];
        let currency = 'INR'; 
        let conversionRate = 0.012; 
        let currentUser = null;
        let isLoginMode = true;

        // --- DATABASE ---
        const products = [
            // FULL 40+ GAMES
            { id: 'g1', type: 'game', title: 'Grand Theft Auto V', platform: 'Steam', price: 999, discount: 50, rating: 4.8, img: 'https://cdn.akamai.steamstatic.com/steam/apps/271590/header.jpg' },
            { id: 'g2', type: 'game', title: 'Red Dead Redemption 2', platform: 'Steam', price: 3199, discount: 60, rating: 4.9, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1174180/header.jpg' },
            { id: 'g3', type: 'game', title: 'EA FC 24', platform: 'EA App', price: 3499, discount: 20, rating: 4.2, img: 'https://cdn.akamai.steamstatic.com/steam/apps/2195250/header.jpg' },
            { id: 'g4', type: 'game', title: 'Cyberpunk 2077', platform: 'GOG', price: 2999, discount: 40, rating: 4.5, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1091500/header.jpg' },
            { id: 'g5', type: 'game', title: 'Elden Ring', platform: 'Steam', price: 3599, discount: 10, rating: 4.9, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1245620/header.jpg' },
            { id: 'g6', type: 'game', title: 'Call of Duty MW3', platform: 'Battle.net', price: 5599, discount: 15, rating: 3.9, img: 'https://cdn.akamai.steamstatic.com/steam/apps/2315580/header.jpg' },
            { id: 'g7', type: 'game', title: 'Minecraft Java & Bedrock', platform: 'Xbox', price: 1999, discount: 0, rating: 4.9, img: 'https://placehold.co/460x215/22c55e/white?text=Minecraft' },
            { id: 'g8', type: 'game', title: 'Valorant Points (1000 VP)', platform: 'Riot', price: 800, discount: 5, rating: 4.8, img: 'https://placehold.co/460x215/ef4444/white?text=Valorant+Points' },
            { id: 'g9', type: 'game', title: 'PUBG 600 UC', platform: 'Mobile', price: 750, discount: 0, rating: 4.5, img: 'https://cdn.akamai.steamstatic.com/steam/apps/578080/header.jpg' },
            { id: 'g10', type: 'game', title: 'Apex Legends 1000 Coins', platform: 'EA App', price: 799, discount: 0, rating: 4.7, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1172470/header.jpg' },
            { id: 'g11', type: 'game', title: 'Assassin\'s Creed Mirage', platform: 'Ubisoft', price: 3499, discount: 25, rating: 4.1, img: 'https://placehold.co/460x215/1e3a8a/white?text=AC+Mirage' },
            { id: 'g12', type: 'game', title: 'Hogwarts Legacy', platform: 'Steam', price: 2999, discount: 30, rating: 4.6, img: 'https://cdn.akamai.steamstatic.com/steam/apps/990080/header.jpg' },
            { id: 'g13', type: 'game', title: 'Spider-Man Remastered', platform: 'Steam', price: 3999, discount: 40, rating: 4.8, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1817070/header.jpg' },
            { id: 'g14', type: 'game', title: 'The Witcher 3: Wild Hunt', platform: 'Steam', price: 800, discount: 75, rating: 4.9, img: 'https://cdn.akamai.steamstatic.com/steam/apps/292030/header.jpg' },
            { id: 'g15', type: 'game', title: 'FIFA 23', platform: 'EA App', price: 999, discount: 80, rating: 4.3, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1811260/header.jpg' },
            { id: 'g16', type: 'game', title: 'Forza Horizon 5', platform: 'Xbox/PC', price: 3499, discount: 50, rating: 4.7, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1551360/header.jpg' },
            { id: 'g17', type: 'game', title: 'Resident Evil 4', platform: 'Steam', price: 3599, discount: 35, rating: 4.9, img: 'https://cdn.akamai.steamstatic.com/steam/apps/2050650/header.jpg' },
            { id: 'g18', type: 'game', title: 'God of War', platform: 'Steam', price: 3299, discount: 50, rating: 4.9, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1593500/header.jpg' },
            { id: 'g19', type: 'game', title: 'Baldur\'s Gate 3', platform: 'Steam', price: 2999, discount: 10, rating: 5.0, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1086940/header.jpg' },
            { id: 'g20', type: 'game', title: 'Starfield', platform: 'Steam', price: 4999, discount: 30, rating: 3.8, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1716740/header.jpg' },
            { id: 'g21', type: 'game', title: 'Helldivers 2', platform: 'Steam', price: 2499, discount: 0, rating: 4.5, img: 'https://cdn.akamai.steamstatic.com/steam/apps/2054970/header.jpg' },
            { id: 'g22', type: 'game', title: 'Palworld', platform: 'Steam', price: 1300, discount: 10, rating: 4.6, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1623730/header.jpg' },
            { id: 'g23', type: 'game', title: 'Tekken 8', platform: 'Steam', price: 4299, discount: 15, rating: 4.7, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1778820/header.jpg' },
            { id: 'g24', type: 'game', title: 'Mortal Kombat 1', platform: 'Steam', price: 4499, discount: 40, rating: 4.2, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1971870/header.jpg' },
            { id: 'g25', type: 'game', title: 'Street Fighter 6', platform: 'Steam', price: 3999, discount: 34, rating: 4.6, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1364780/header.jpg' },
            { id: 'g26', type: 'game', title: 'Fallout 4', platform: 'Steam', price: 999, discount: 60, rating: 4.5, img: 'https://cdn.akamai.steamstatic.com/steam/apps/377160/header.jpg' },
            { id: 'g27', type: 'game', title: 'Skyrim Special Edition', platform: 'Steam', price: 1799, discount: 75, rating: 4.8, img: 'https://cdn.akamai.steamstatic.com/steam/apps/489830/header.jpg' },
            { id: 'g28', type: 'game', title: 'No Man\'s Sky', platform: 'Steam', price: 1799, discount: 50, rating: 4.4, img: 'https://cdn.akamai.steamstatic.com/steam/apps/275850/header.jpg' },
            { id: 'g29', type: 'game', title: 'Terraria', platform: 'Steam', price: 369, discount: 50, rating: 4.9, img: 'https://cdn.akamai.steamstatic.com/steam/apps/105600/header.jpg' },
            { id: 'g30', type: 'game', title: 'Stardew Valley', platform: 'Steam', price: 479, discount: 20, rating: 4.9, img: 'https://cdn.akamai.steamstatic.com/steam/apps/413150/header.jpg' },
            { id: 'g31', type: 'game', title: 'Rust', platform: 'Steam', price: 1599, discount: 33, rating: 4.5, img: 'https://cdn.akamai.steamstatic.com/steam/apps/252490/header.jpg' },
            { id: 'g32', type: 'game', title: 'DayZ', platform: 'Steam', price: 2799, discount: 40, rating: 4.2, img: 'https://cdn.akamai.steamstatic.com/steam/apps/221100/header.jpg' },
            { id: 'g33', type: 'game', title: 'Rainbow Six Siege', platform: 'Ubisoft', price: 999, discount: 60, rating: 4.4, img: 'https://cdn.akamai.steamstatic.com/steam/apps/359550/header.jpg' },
            { id: 'g34', type: 'game', title: 'Destiny 2: Lightfall', platform: 'Steam', price: 2199, discount: 50, rating: 3.5, img: 'https://placehold.co/460x215/4c1d95/white?text=Destiny+2+Lightfall' },
            { id: 'g35', type: 'game', title: 'Overwatch 2: 1000 Coins', platform: 'Battle.net', price: 800, discount: 0, rating: 4.0, img: 'https://placehold.co/460x215/f97316/white?text=OW2+Coins' },
            { id: 'g36', type: 'game', title: 'Genshin Impact 1098 Crystals', platform: 'HoYoverse', price: 1290, discount: 0, rating: 4.7, img: 'https://placehold.co/460x215/0ea5e9/white?text=Genshin+Crystals' },
            { id: 'g37', type: 'game', title: 'Ghost of Tsushima', platform: 'PSN', price: 3999, discount: 20, rating: 4.9, img: 'https://placehold.co/460x215/1f2937/white?text=Ghost+of+Tsushima' },
            { id: 'g38', type: 'game', title: 'The Last of Us Part I', platform: 'Steam', price: 3999, discount: 33, rating: 4.6, img: 'https://placehold.co/460x215/166534/white?text=TLOU+Part+I' },
            { id: 'g39', type: 'game', title: 'Horizon Zero Dawn', platform: 'Steam', price: 3299, discount: 60, rating: 4.8, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1151640/header.jpg' },
            { id: 'g40', type: 'game', title: 'Spider-Man: Miles Morales', platform: 'Steam', price: 3299, discount: 40, rating: 4.7, img: 'https://cdn.akamai.steamstatic.com/steam/apps/1817190/header.jpg' },

            // UNSPLASH GIFT CARDS (High Quality Photography)
            { id: 'gc1', type: 'giftcard', title: 'Amazon Gift Card', platform: 'Shopping', price: 1000, options: '₹500 - ₹10000', img: 'https://images.unsplash.com/photo-1622560480654-d96214fdc887?w=600&h=400&fit=crop&q=80' },
            { id: 'gc2', type: 'giftcard', title: 'Flipkart E-Voucher', platform: 'Shopping', price: 1000, options: '₹100 - ₹5000', img: 'https://images.unsplash.com/photo-1607082349566-187342175e2f?w=600&h=400&fit=crop&q=80' },
            { id: 'gc3', type: 'giftcard', title: 'BookMyShow Card', platform: 'Entertainment', price: 500, options: '₹250 - ₹2000', img: 'https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?w=600&h=400&fit=crop&q=80' },
            { id: 'gc4', type: 'giftcard', title: 'Ajio E-Gift Card', platform: 'Fashion', price: 2000, options: '₹500 - ₹5000', img: 'https://images.unsplash.com/photo-1483985988355-763728e1935b?w=600&h=400&fit=crop&q=80' },
            { id: 'gc5', type: 'giftcard', title: 'Myntra Voucher', platform: 'Fashion', price: 1000, options: '₹500 - ₹3000', img: 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=600&h=400&fit=crop&q=80' },
            { id: 'gc6', type: 'giftcard', title: 'Google Play Recharge', platform: 'Mobile', price: 500, options: '₹100 - ₹5000', img: 'https://images.unsplash.com/photo-1573867639040-6dd25fa5f597?w=600&h=400&fit=crop&q=80' },
            { id: 'gc7', type: 'giftcard', title: 'Steam Wallet Code', platform: 'Gaming', price: 1000, options: '₹150 - ₹5000', img: 'https://images.unsplash.com/photo-1616588589676-62b3bd4ff6d2?w=600&h=400&fit=crop&q=80' },
            { id: 'gc8', type: 'giftcard', title: 'PlayStation Store Wallet', platform: 'Gaming', price: 1000, options: '₹500 - ₹4000', img: 'https://images.unsplash.com/photo-1606144042743-18e38d49a3ae?w=600&h=400&fit=crop&q=80' },
            { id: 'gc9', type: 'giftcard', title: 'Xbox Gift Card', platform: 'Gaming', price: 1000, options: '₹500 - ₹5000', img: 'https://images.unsplash.com/photo-1605901309584-818e25960b8f?w=600&h=400&fit=crop&q=80' },
            { id: 'gc10', type: 'giftcard', title: 'Netflix E-Pin', platform: 'Streaming', price: 500, options: '₹149 - ₹649', img: 'https://images.unsplash.com/photo-1522869635100-9f4c5e86aa37?w=600&h=400&fit=crop&q=80' },
            { id: 'gc11', type: 'giftcard', title: 'Spotify Premium Card', platform: 'Audio', price: 359, options: '1 - 12 Months', img: 'https://images.unsplash.com/photo-1614680376593-902f74cf0d41?w=600&h=400&fit=crop&q=80' },
            { id: 'gc12', type: 'giftcard', title: 'Disney+ Hotstar', platform: 'Streaming', price: 899, options: 'Super / Premium', img: 'https://images.unsplash.com/photo-1586899028174-e7098604235b?w=600&h=400&fit=crop&q=80' },

            // UNSPLASH SUBSCRIPTIONS (High Quality Photography)
            { id: 's1', type: 'sub', title: 'PlayStation Plus Extra', platform: 'Subscription', price: 749, options: '1 / 3 / 12 Months', img: 'https://images.unsplash.com/photo-1606813907291-d86efa9b94db?w=600&h=400&fit=crop&q=80' },
            { id: 's2', type: 'sub', title: 'Xbox Game Pass Ultimate', platform: 'Subscription', price: 549, options: '1 / 3 / 6 Months', img: 'https://images.unsplash.com/photo-1605901309584-818e25960b8f?w=600&h=400&fit=crop&q=80' },
            { id: 's3', type: 'sub', title: 'EA Play Membership', platform: 'Subscription', price: 315, options: '1 Month / 1 Year', img: 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?w=600&h=400&fit=crop&q=80' },
            { id: 's4', type: 'sub', title: 'Netflix Premium Plan', platform: 'Subscription', price: 649, options: 'Monthly Auto-Renew', img: 'https://images.unsplash.com/photo-1574375927938-d5a98e8ffe85?w=600&h=400&fit=crop&q=80' },
            { id: 's5', type: 'sub', title: 'Amazon Prime Video', platform: 'Subscription', price: 1499, options: 'Yearly Plan', img: 'https://images.unsplash.com/photo-1593784991095-a205069470b6?w=600&h=400&fit=crop&q=80' },
            { id: 's6', type: 'sub', title: 'Spotify Premium Individual', platform: 'Subscription', price: 119, options: 'Monthly Auto-Renew', img: 'https://images.unsplash.com/photo-1614680376573-df3480f0c6ff?w=600&h=400&fit=crop&q=80' },
        ];

        // --- UI RENDERING ---
        function formatPrice(inrPrice) {
            return currency === 'USD' ? `$${(inrPrice * conversionRate).toFixed(2)}` : `₹${inrPrice.toLocaleString('en-IN')}`;
        }

        function generateCard(item) {
            const currentPrice = item.price * (1 - (item.discount || 0) / 100);
            const isGame = item.type === 'game';
            
            // For Giftcards/Subs we use 3/2 aspect ratio to look like physical cards, games use standard cover height
            const imgClass = isGame ? "h-32 sm:h-40" : "aspect-[3/2]"; 

            return `
                <div class="product-card bg-white dark:bg-gray-800 rounded-xl shadow border border-gray-100 dark:border-gray-700 overflow-hidden flex flex-col cursor-pointer">
                    <div class="product-img-wrapper relative w-full ${imgClass} bg-gray-200 dark:bg-gray-700">
                        <img src="${item.img}" alt="${item.title}" class="product-img w-full h-full object-cover" loading="lazy" onerror="this.onerror=null; this.src='https://placehold.co/600x400/333333/ffffff?text=Image+Unavailable';">
                        ${item.discount ? `<div class="absolute top-2 right-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded shadow-sm">-${item.discount}%</div>` : ''}
                    </div>
                    <div class="p-4 flex flex-col flex-grow">
                        <div class="text-xs text-gray-500 dark:text-gray-400 mb-1 flex justify-between uppercase tracking-wider font-semibold">
                            <span><i class="fa-solid ${isGame ? 'fa-gamepad' : (item.type === 'giftcard' ? 'fa-gift' : 'fa-ticket')} mr-1"></i>${item.platform}</span>
                            ${item.rating ? `<span class="text-yellow-500"><i class="fa-solid fa-star"></i> ${item.rating}</span>` : ''}
                        </div>
                        <h3 class="font-bold text-base mb-1 line-clamp-2">${item.title}</h3>
                        
                        ${item.options ? `<p class="text-xs text-primary dark:text-purple-400 mb-3 bg-purple-50 dark:bg-purple-900/20 inline-block px-2 py-1 rounded border border-purple-100 dark:border-purple-800">Options: ${item.options}</p>` : '<div class="mb-3"></div>'}
                        
                        <div class="mt-auto flex items-center justify-between pt-2 border-t border-gray-100 dark:border-gray-700">
                            <div>
                                <span class="text-[10px] text-gray-400 block leading-none mb-1">Starts at</span>
                                <span class="font-bold text-lg">${formatPrice(currentPrice)}</span>
                                ${item.discount > 0 ? `<span class="text-xs line-through text-gray-400 ml-1">${formatPrice(item.price)}</span>` : ''}
                            </div>
                            <button onclick="addToCart('${item.id}')" class="bg-primary hover:bg-secondary text-white px-4 py-2 rounded-lg text-sm font-bold transition flex items-center shadow hover:shadow-md">
                                Add <i class="fa-solid fa-plus ml-1 text-xs"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderProducts() {
            document.getElementById('gamesGrid').innerHTML = products.filter(p => p.type === 'game').map(generateCard).join('');
            document.getElementById('giftCardsGrid').innerHTML = products.filter(p => p.type === 'giftcard').map(generateCard).join('');
            document.getElementById('subsGrid').innerHTML = products.filter(p => p.type === 'sub').map(generateCard).join('');
        }

        // --- CART LOGIC ---
        window.addToCart = (id) => {
            const product = products.find(p => p.id === id);
            const existing = cart.find(item => item.id === id);
            if (existing) existing.qty++;
            else cart.push({ ...product, qty: 1, currentPrice: product.price * (1 - (product.discount || 0) / 100) });
            saveCart();
            updateCartUI();
        };

        window.updateQty = (id, change) => {
            const item = cart.find(i => i.id === id);
            if (!item) return;
            item.qty += change;
            if (item.qty <= 0) cart = cart.filter(i => i.id !== id);
            saveCart();
            updateCartUI();
        };

        function saveCart() {
            localStorage.setItem('playWithEaseCart', JSON.stringify(cart));
        }

        function updateCartUI() {
            document.getElementById('cartCount').innerText = cart.reduce((sum, item) => sum + item.qty, 0);
            const cartItemsDiv = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                cartItemsDiv.innerHTML = '<div class="text-center text-gray-500 mt-10"><i class="fa-solid fa-box-open text-4xl mb-3"></i><p>Your cart is empty</p></div>';
                document.getElementById('cartTotalUI').innerText = formatPrice(0);
                return;
            }

            let total = 0;
            cartItemsDiv.innerHTML = cart.map(item => {
                const itemTotal = item.currentPrice * item.qty;
                total += itemTotal;
                return `
                    <div class="flex items-center gap-4 bg-gray-50 dark:bg-gray-700 p-3 rounded-lg">
                        <img src="${item.img}" class="w-16 h-12 object-cover rounded" onerror="this.onerror=null; this.src='https://placehold.co/100x100/333333/ffffff?text=Img';">
                        <div class="flex-1">
                            <h4 class="text-sm font-bold line-clamp-1">${item.title}</h4>
                            <div class="text-primary font-semibold text-sm">${formatPrice(item.currentPrice)}</div>
                        </div>
                        <div class="flex items-center space-x-2 bg-white dark:bg-gray-600 rounded px-2 py-1 shadow-sm">
                            <button onclick="updateQty('${item.id}', -1)" class="text-gray-500 hover:text-red-500"><i class="fa-solid fa-minus text-xs"></i></button>
                            <span class="text-sm font-bold w-4 text-center">${item.qty}</span>
                            <button onclick="updateQty('${item.id}', 1)" class="text-gray-500 hover:text-green-500"><i class="fa-solid fa-plus text-xs"></i></button>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('cartTotalUI').innerText = formatPrice(total);
        }

        // --- NAVIGATION & CHECKOUT ---
        window.toggleCart = () => {
            document.getElementById('cartDrawer').classList.toggle('cart-open');
            document.getElementById('cartOverlay').classList.toggle('hide');
        };

        window.showView = (viewId) => {
            ['homeView', 'authView', 'profileView', 'checkoutView', 'successView'].forEach(id => {
                document.getElementById(id).classList.add('hide');
            });
            document.getElementById(viewId).classList.remove('hide');
            window.scrollTo(0,0);
        };

        window.proceedToCheckout = () => {
            if (cart.length === 0) return alert('Cart is empty!');
            if (!currentUser) {
                toggleCart();
                alert('Please login to checkout.');
                showView('authView');
                return;
            }
            toggleCart();
            
            let total = 0;
            const checkoutItemsDiv = document.getElementById('checkoutItems');
            checkoutItemsDiv.innerHTML = cart.map(item => {
                const itemTotal = item.currentPrice * item.qty;
                total += itemTotal;
                return `
                    <div class="flex justify-between items-center text-sm">
                        <span>${item.qty}x ${item.title}</span>
                        <span class="font-medium">${formatPrice(itemTotal)}</span>
                    </div>
                `;
            }).join('');
            document.getElementById('checkoutTotal').innerText = formatPrice(total);
            showView('checkoutView');
        };

        window.confirmOrder = () => {
            cart = [];
            saveCart();
            updateCartUI();
            showView('successView');
        };

        // --- AUTHENTICATION ---
        window.handleAuthClick = () => {
            if (currentUser) showView('profileView');
            else showView('authView');
        };

        window.toggleAuthMode = () => {
            isLoginMode = !isLoginMode;
            document.getElementById('authTitle').innerText = isLoginMode ? 'Login to PlayWithEase' : 'Create an Account';
            document.getElementById('authToggleText').innerText = isLoginMode ? "Don't have an account?" : "Already have an account?";
            document.getElementById('authError').classList.add('hide');
        };

        window.handleAuthSubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const errorDiv = document.getElementById('authError');
            
            try {
                if (isLoginMode) {
                    await signInWithEmailAndPassword(auth, email, password);
                } else {
                    await createUserWithEmailAndPassword(auth, email, password);
                }
                document.getElementById('authForm').reset();
                showView('profileView');
            } catch (error) {
                errorDiv.innerText = error.message.replace('Firebase: ', '');
                errorDiv.classList.remove('hide');
            }
        };

        window.logoutUser = async () => {
            await signOut(auth);
            showView('homeView');
        };

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            const authBtnIcon = document.querySelector('#authBtn i');
            if (user) {
                authBtnIcon.classList.remove('fa-regular');
                authBtnIcon.classList.add('fa-solid');
                authBtnIcon.classList.add('text-primary');
                document.getElementById('profileEmail').innerText = user.email;
            } else {
                authBtnIcon.classList.add('fa-regular');
                authBtnIcon.classList.remove('fa-solid');
                authBtnIcon.classList.remove('text-primary');
            }
        });

        // --- MISC UTILS ---
        document.getElementById('currencyBtn').addEventListener('click', (e) => {
            currency = currency === 'INR' ? 'USD' : 'INR';
            e.target.innerText = currency === 'INR' ? 'INR ₹' : 'USD $';
            renderProducts();
            updateCartUI();
        });

        const htmlEl = document.documentElement;
        const themeBtn = document.getElementById('themeToggle');
        
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            htmlEl.classList.add('dark');
        }

        themeBtn.addEventListener('click', () => {
            htmlEl.classList.toggle('dark');
        });

        // Init
        renderProducts();
        updateCartUI();
    </script>
</body>
</html>
