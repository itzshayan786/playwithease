<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PlayWithEase Admin</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
font-family:Poppins;
background:#0f172a;
color:#fff;
min-height:100vh;
padding:20px;
}

h1{margin-bottom:20px}

.order{
background:#1e293b;
padding:20px;
border-radius:14px;
margin-bottom:20px;
box-shadow:0 10px 30px rgba(0,0,0,.5);
}

.order-header{
display:flex;
justify-content:space-between;
flex-wrap:wrap;
margin-bottom:10px;
}

select,input{
margin-top:8px;
padding:6px;
border-radius:6px;
border:none;
}

button{
margin-top:8px;
padding:6px 12px;
border:none;
border-radius:8px;
cursor:pointer;
}

.save{background:#16a34a;color:#fff;}
</style>
</head>

<body>

<h1>PlayWithEase Admin Panel</h1>

<div id="ordersContainer"></div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
getFirestore, 
collection, 
onSnapshot, 
doc, 
updateDoc 
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyAxuYwom2tuGTz3Nsi-6ndYSwK7BkEJIVs",
authDomain:"playwithease.firebaseapp.com",
projectId:"playwithease"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const container = document.getElementById("ordersContainer");

onSnapshot(collection(db,"orders"), (snapshot)=>{

container.innerHTML = "";

snapshot.forEach(docSnap=>{

let order = docSnap.data();

container.innerHTML += `
<div class="order">

<div class="order-header">
<div><b>Order ID:</b> ${docSnap.id}</div>

<select onchange="updateStatus('${docSnap.id}',this.value)">
<option ${order.status==="in-progress"?"selected":""} value="in-progress">Pending</option>
<option ${order.status==="success"?"selected":""} value="success">Success</option>
<option ${order.status==="cancelled"?"selected":""} value="cancelled">Cancelled</option>
<option ${order.status==="refunded"?"selected":""} value="refunded">Refunded</option>
</select>
</div>

<div>Email: ${order.userEmail}</div>
<div>Total: â‚¹${order.total}</div>

<div style="margin-top:10px;">
<b>Account Details</b><br>

<input placeholder="Username" id="user-${docSnap.id}" value="${order.credentials?.username || ""}">
<input placeholder="Password" id="pass-${docSnap.id}" value="${order.credentials?.password || ""}">

<br>

<button class="save" onclick="saveCredentials('${docSnap.id}')">
Save Credentials
</button>

</div>

</div>
`;

});

});

/* STATUS UPDATE */
window.updateStatus = async function(id,status){
await updateDoc(doc(db,"orders",id), { status: status });
};

/* SAVE CREDENTIALS */
window.saveCredentials = async function(id){

let username = document.getElementById("user-"+id).value;
let password = document.getElementById("pass-"+id).value;

await updateDoc(doc(db,"orders",id), {
credentials:{
username: username,
password: password
}
});

alert("Saved");

};

</script>

</body>
</html>
