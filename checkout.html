<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Secure Checkout | PlayWithEase</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'] },
                    colors: { bg: '#050505', surface: '#121212', primary: '#3b82f6' },
                    animation: { 'fade-in': 'fadeIn 0.5s ease-out' },
                    keyframes: { fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } } }
                }
            }
        }
    </script>
    <style>
        body { background-color: #050505; color: #fff; }
        .glass { background: rgba(20, 20, 20, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .loader-bar { height: 4px; background: linear-gradient(90deg, #3b82f6, #8b5cf6); animation: load 2s infinite linear; width: 100%; transform-origin: left; }
        @keyframes load { 0% { transform: scaleX(0); } 50% { transform: scaleX(0.5); } 100% { transform: scaleX(1); opacity: 0; } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="h-20 border-b border-white/10 flex items-center justify-between px-6 lg:px-12 bg-[#0a0a0a]">
        <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
            <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold text-lg">P</div>
            <span class="font-bold text-lg tracking-tight">PlayWithEase</span>
        </a>
        <div class="flex items-center gap-2 text-sm font-medium text-green-500 bg-green-500/10 px-3 py-1.5 rounded-full border border-green-500/20">
            <i class="fa-solid fa-lock"></i> 256-Bit SSL Secure
        </div>
    </header>

    <main class="flex-grow max-w-6xl mx-auto w-full p-4 lg:p-8 grid grid-cols-1 lg:grid-cols-3 gap-8 animate-fade-in">
        
        <div class="lg:col-span-2 space-y-6">
            
            <div class="glass rounded-2xl p-6 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-1 h-full bg-blue-500"></div>
                <h2 class="text-xl font-bold mb-4 flex items-center gap-3">
                    <span class="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-sm">1</span>
                    Contact Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <input type="email" id="userEmail" placeholder="Email Address" class="w-full bg-[#050505] border border-white/10 rounded-lg py-3 px-4 focus:border-blue-500 focus:outline-none transition-colors">
                    <input type="text" id="userPhone" placeholder="Mobile Number (Optional)" class="w-full bg-[#050505] border border-white/10 rounded-lg py-3 px-4 focus:border-blue-500 focus:outline-none transition-colors">
                </div>
            </div>

            <div class="glass rounded-2xl p-6 relative overflow-hidden">
                <div class="absolute top-0 left-0 w-1 h-full bg-purple-500"></div>
                <h2 class="text-xl font-bold mb-6 flex items-center gap-3">
                    <span class="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center text-sm">2</span>
                    Payment Method (UPI)
                </h2>

                <div class="bg-[#050505] rounded-xl border border-white/10 p-6 md:p-8 flex flex-col md:flex-row items-center gap-8">
                    <div class="bg-white p-3 rounded-xl shadow-lg shrink-0">
                        <img id="qrCode" src="" alt="Scanning..." class="w-48 h-48 object-contain">
                    </div>

                    <div class="flex-1 w-full text-center md:text-left space-y-4">
                        <div>
                            <p class="text-sm text-gray-400 mb-1">Scan to pay</p>
                            <h3 id="payAmount" class="text-3xl font-bold text-white">â‚¹0</h3>
                        </div>

                        <div class="bg-[#121212] p-3 rounded-lg border border-white/10 flex items-center justify-between">
                            <span class="text-sm font-mono text-gray-300 truncate mr-2">shayanff98@okhdfcbank</span>
                            <button onclick="navigator.clipboard.writeText('shayanff98@okhdfcbank')" class="text-blue-400 text-xs font-bold hover:text-white uppercase">Copy</button>
                        </div>

                        <div class="flex items-center justify-center md:justify-start gap-4 text-xs text-gray-500">
                            <span class="flex items-center gap-1"><i class="fa-brands fa-google-pay text-base"></i> GPay</span>
                            <span class="flex items-center gap-1"><i class="fa-solid fa-phone text-base"></i> PhonePe</span>
                            <span class="flex items-center gap-1"><i class="fa-brands fa-amazon-pay text-base"></i> Paytm</span>
                        </div>

                        <div class="flex items-center justify-center md:justify-start gap-2 text-yellow-500 bg-yellow-500/5 py-2 px-3 rounded-lg border border-yellow-500/10 w-fit">
                            <div class="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></div>
                            <span class="text-xs font-mono">Session expires in <span id="timer">05:00</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="confirmOrder()" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-green-600/20 transition-all flex items-center justify-center gap-3 text-lg group">
                <i class="fa-brands fa-whatsapp text-2xl group-hover:scale-110 transition-transform"></i>
                I have made the payment
            </button>
            <p class="text-center text-xs text-gray-500 mt-4">By clicking above, you confirm the transfer. Order details will be sent to WhatsApp for instant verification.</p>
        </div>

        <div class="lg:col-span-1">
            <div class="glass rounded-2xl p-6 sticky top-6">
                <h3 class="text-lg font-bold mb-4">Order Summary</h3>
                
                <div id="orderItems" class="space-y-4 mb-6 max-h-[300px] overflow-y-auto pr-2 custom-scroll">
                    </div>

                <div class="h-px bg-white/10 my-4"></div>

                <div class="space-y-2 text-sm">
                    <div class="flex justify-between text-gray-400">
                        <span>Subtotal</span>
                        <span id="summarySubtotal">â‚¹0</span>
                    </div>
                    <div class="flex justify-between text-gray-400">
                        <span>Platform Fee</span>
                        <span class="text-green-400">FREE</span>
                    </div>
                    <div class="flex justify-between text-gray-400">
                        <span>GST (18%)</span>
                        <span id="summaryTax">â‚¹0</span>
                    </div>
                </div>

                <div class="h-px bg-white/10 my-4"></div>

                <div class="flex justify-between items-center">
                    <span class="font-bold text-lg">Total</span>
                    <span id="summaryTotal" class="font-bold text-2xl text-blue-400">â‚¹0</span>
                </div>

                <div class="mt-6 bg-blue-500/10 border border-blue-500/20 rounded-lg p-3 flex gap-3 items-start">
                    <i class="fa-solid fa-bolt text-blue-400 mt-1"></i>
                    <div>
                        <p class="text-xs font-bold text-blue-400">Instant Delivery</p>
                        <p class="text-[10px] text-gray-400">Digital keys/accounts are delivered immediately after WhatsApp verification.</p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="border-t border-white/10 bg-[#050505] py-8 mt-auto">
        <div class="max-w-6xl mx-auto px-6 text-center">
            <p class="text-gray-500 text-xs">&copy; 2024 PlayWithEase. Secure Payments powered by UPI.</p>
        </div>
    </footer>

    <script>
        // 1. Retrieve Cart
        const cart = JSON.parse(localStorage.getItem('pwe_cart')) || [];
        const orderID = 'ORD-' + Math.floor(10000 + Math.random() * 90000);
        
        // 2. DOM Elements
        const orderItemsContainer = document.getElementById('orderItems');
        const qrImage = document.getElementById('qrCode');
        const payAmountLabel = document.getElementById('payAmount');
        const summaryTotalLabel = document.getElementById('summaryTotal');
        const summarySubtotalLabel = document.getElementById('summarySubtotal');
        const summaryTaxLabel = document.getElementById('summaryTax');

        // 3. Calculation & Render
        let subtotal = 0;

        if (cart.length === 0) {
            window.location.href = 'index.html'; // Redirect back if empty
        } else {
            cart.forEach(item => {
                subtotal += item.price * item.qty;
                
                // Render Item
                orderItemsContainer.innerHTML += `
                    <div class="flex gap-3">
                        <img src="${item.img}" class="w-12 h-16 object-cover rounded-md border border-white/10">
                        <div class="flex-1">
                            <h4 class="text-sm font-bold text-gray-200 line-clamp-1">${item.title}</h4>
                            <p class="text-xs text-gray-500">Qty: ${item.qty}</p>
                            <p class="text-xs font-bold text-blue-400 mt-1">â‚¹${(item.price * item.qty).toLocaleString()}</p>
                        </div>
                    </div>
                `;
            });

            // Tax & Total
            const tax = Math.round(subtotal * 0.18);
            const total = subtotal + tax;

            // Update Labels
            summarySubtotalLabel.innerText = `â‚¹${subtotal.toLocaleString()}`;
            summaryTaxLabel.innerText = `â‚¹${tax.toLocaleString()}`;
            summaryTotalLabel.innerText = `â‚¹${total.toLocaleString()}`;
            payAmountLabel.innerText = `â‚¹${total.toLocaleString()}`;

            // Generate QR
            const upiUrl = `upi://pay?pa=shayanff98@okhdfcbank&pn=PlayWithEase&am=${total}&cu=INR&tn=${orderID}`;
            qrImage.src = `https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(upiUrl)}`;
        }

        // 4. Timer Logic
        let timeLeft = 300; // 5 mins
        const timerLabel = document.getElementById('timer');
        const timerInterval = setInterval(() => {
            const minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            seconds = seconds < 10 ? '0' + seconds : seconds;
            timerLabel.innerText = `${minutes}:${seconds}`;
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                alert("Session Expired");
                window.location.href = 'index.html';
            }
            timeLeft--;
        }, 1000);

        // 5. Confirm Payment
        function confirmOrder() {
            const total = payAmountLabel.innerText;
            const itemsList = cart.map(i => `${i.title} (x${i.qty})`).join(', ');
            
            // Build WhatsApp Message
            const message = `*NEW ORDER ALERT* ðŸš¨\n\nðŸ†” *Order ID:* ${orderID}\nðŸ’° *Amount Paid:* ${total}\nðŸ“¦ *Items:* ${itemsList}\n\nâœ… Payment completed via UPI. Please verify and send delivery.`;
            
            // Clear Cart & Redirect
            localStorage.removeItem('pwe_cart');
            
            // Open WhatsApp
            window.location.href = `https://wa.me/917001568884?text=${encodeURIComponent(message)}`;
        }
    </script>
</body>
</html>
